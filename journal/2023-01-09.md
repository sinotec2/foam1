---
tags: pandas unix_cmd
---
# Monday, January 9, 2023

## 從計畫資料查詢計畫主管名稱

- 點選執行中之計畫共800多項(共9頁)
- 全選→貼上excel→下頁
- 整理成一個表、
- 將計畫主管另存一工作表、執行資料→刪除重複的項目，得到共77人
- 由下2各方式得到公司所有人的email
- 尋找email`=LOOKUP(A2,工作表3!$D:$D,工作表3!B:B)`
- 尋找部門`=LOOKUP(A2,工作表3!$D:$D,工作表3!C:C)`

## 從員工分機-email查詢獲取資料表

### excel

- 各部門全選、在excel中貼上表格
- 整合4各部門後、再行整理

### grep

- 分別下載各部門頁面之html檔案
- 用grep產生姓名、email等純文字
- 再用python來整合

```bash
kuang@node03 ~/Documents/202301
$ cat mk.cs
grep 'white-space:nowrap' *html|cut -d'>' -f2 |cut -d'<' -f1>name.txt
grep EmpTelData.Email *html|cut -d'>' -f7|cut -d'<' -f1>email.txt
grep "<td\ style\=\"text\-align:center\"\ class\=\"ng\-binding\">" *html|cut -d'> -f2|cut -d'<' -f1>t3.txt
```

- python

```python
from pandas import *
with open('name.txt','r') as f:
    name=[i.strip('\n') for i in f]
with open('email.txt','r') as f:
    email=[i.strip('\n') for i in f]
nam_mail={i:j for i,j in zip(name,email)}
with open('t3.txt','r') as f:
    ndp=[i.strip('\n') for i in f]
num=[int(i.split('>')[1].split('<')[0]) for i in ndp[::3]]
dpt=[i.split('>')[1].split('<')[0] for i in ndp[1::3]]
df=DataFrame({'name':name,'email':email,'dpt':dpt,'EmpNum':num})
col='EmpNum email dpt name'.split()
df[col].set_index('EmpNum').to_csv('nam_email.txt')
```
